<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Helper_.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Helper_.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module Helper_
 * 
 * This module contains utility functions.
 */

/**
 * Converts an integer as returned from the PSS Fleet Data API to an {@link module:Enums~AllianceMembership|AllianceMembership} enum value.
 *
 * @param {integer} fleetRank - The fleet rank value as returned by the PSS Fleet Data API.
 * 
 * @return {(AllianceMembership|null)} - The {@link module:Enums~AllianceMembership|AllianceMembership} enum value matching the input. Returns **null**, if the provided **fleetRank** doesn't match an enum value. 
 */
function decodeFleetRank_(fleetRank) {
  for (let key of Object.keys(AllianceMembership)) {
    let rank = AllianceMembership[key];
    if (rank.value == fleetRank) {
      return rank;
    }
  }

  return null;
}

/**
 * Converts an integer as returned from the PSS Fleet Data API to a **Date** object.
 *
 * @param {integer} [secondsSincePssStart] - The number of seconds that passed since Jan 6th, 2016.
 * 
 * @return {Date} - A **Date** object representing a specific point in time since PSS started, if **secondsSincePssStart** is truthy. Else, **null**.
 */
function decodeTimestamp_(secondsSincePssStart) {
  if (!secondsSincePssStart &amp;&amp; secondsSincePssStart !== 0) {
    return null;
  }

  let result = new Date(PSS_START_DATE_MS + parseInt(secondsSincePssStart) * 1000);
  return result;
}

/**
 * Takes a **URL** and a dictionary of query parameters and turns them into a full URL.
 *
 * @param {string} url - The base URL to append the query parameters to.
 * @param {object} queryParameters - An object having the parameter names as keys and their values as values. The values will get converted to strings and url-encoded.
 * 
 * @return {string} - A full URL including query parameters.
 */
function assembleUrl_(url, queryParameters) {
  let params = [];
  for (let name in queryParameters) {
    params.push(name + "=" + encodeURIComponent(queryParameters[name]));
  }

  let paramsString = params.join("&amp;");
  if (paramsString) {
    url = url + "?" + paramsString;
  }

  return url;
}

/**
 * Takes some query parameters and adds them to a dictionary, if they're defined.
 *
 * @param {Date} [fromDate] - The earliest date for which data shall be returned.
 * @param {Date} [toDate] - The latest date for which data shall be returned.
 * @param {(Interval|string)} [interval] - Return the data from the specified time frame in hourly (value: "hour"), daily (value: "day", last {@link module:Classes_API~Collection|Collection} of a day) or monthly (value: "month", last {@link module:Classes_API~Collection|Collection} of a month) interval.
 * @param {boolean} [desc] - Return the results in descending order by timestamp.
 * @param {integer} [skip] - Skip this number of results from the result set.
 * @param {integer} [take] - Limit the number of results returned.
 * 
 * @return {object} - An object containing the keys and values for each of the parameters provided. The object may have no keys, if no parameter was provided.
 */
function constructParamsObject_(fromDate, toDate, interval, desc, skip, take) {
  let parameters = {};
  if (fromDate) {
    parameters["fromDate"] = convertDateToParameter_(fromDate);
  }
  if (toDate) {
    parameters["toDate"] = convertDateToParameter_(toDate);
  }
  if (interval) {
    parameters["interval"] = convertIntervalToParameter_(interval);
  }
  if (desc === true || desc === false) {
    parameters["desc"] = desc;
  }
  if (skip || skip == 0) {
    parameters["skip"] = skip;
  }
  if (take) {
    parameters["take"] = take;
  }

  return parameters;
}

/**
 * Takes a **Date** and converts it to a string to be used as a parameter in a call to the PSS Fleet Data API.
 *
 * @param {(Date|string)} date - The date to get converted. 
 * 
 * @return {(string|null)} - A **Date** converted to an ISO-8601 string, if the input value is of type **Date**. The input, if the input is of type **string**. Else, **null**.
 */
function convertDateToParameter_(date) {
  if (typeof(date.getUTCFullYear) === "function") {
    return formatDateUTC_(date);
  }

  if (typeof(date) === "string") {
    return date;
  }

  return null;
}

/**
 * Takes an {@link module:Enums~Interval|Interval} and converts it to a string to be used as a parameter in a call to the PSS Fleet Data API.
 *
 * @param {(Interval|string)} interval - The interval to get converted. 
 * 
 * @return {(string|null)} - A {@link module:Enums~Interval|Interval} converted to its string representation, if the input value is of type {@link module:Enums~Interval|Interval}. The input, if the input is of type **string**. Else, **null**.
 */
function convertIntervalToParameter_(interval) {
  if (typeof(interval) === "object" &amp;&amp; interval.type === "Interval") {
    return interval.value;
  }

  if (typeof(interval) === "string") {
    return interval;
  }

  return null;
}

/**
 * Makes a GET call to the PSS Fleet Data API endpoint specified by the given **path**, passing the specified parameters.
 *
 * @param {string} path - The url path to the endpoint to get data from. Does not include protocol or domain of the PSS Fleet Data API server.
 * @param {integer} [allianceId] - The **allianceId** parameter for the API endpoint. Replaces an **{allianceId}** placeholder in the **path** parameter.
 * @param {integer} [collectionId] - The **collectionId** parameter for the API endpoint. Replaces a **{collectionId}** placeholder in the **path** parameter.
 * @param {integer} [userId] - The **userId** parameter for the API endpoint. Replaces a **{userId}** placeholder in the **path** parameter.
 * @param {Date} [fromDate] - The earliest date for which data shall be returned.
 * @param {Date} [toDate] - The latest date for which data shall be returned.
 * @param {Interval} [interval] - Return the data from the specified time frame in hourly, daily (last Collection of a day) or monthly (last Collection of a month) interval.
 * @param {boolean} [desc] - Return the results in descending order by timestamp.
 * @param {integer} [skip] - Skip this number of results from the result set.
 * @param {integer} [take] - Limit the number of results returned. 
 * 
 * @return {HTTPResponse} - An object representing the response of the PSS Fleet Data API server.
 */
function getFromApiUrl_(path, allianceId, collectionId, userId, fromDate, toDate, interval, desc, skip, take) {
  path = path.replace("{allianceId}", allianceId).replace("{collectionId}", collectionId).replace("{userId}", userId);
  let parameters = constructParamsObject_(fromDate, toDate, interval, desc, skip, take);

  let url = assembleUrl_(API_BASE_URL + path, parameters);

  return getFromUrl_(url);
}

/**
 * Makes a GET call to a server represented by the given **URL**.
 *
 * @param {string} url - The URL to get.
 * 
 * @return {HTTPResponse} - An object representing the response of the requested server.
 */
function getFromUrl_(url) {
  let response = UrlFetchApp.fetch(url, FETCH_OPTIONS);
  return response;
}

/**
 * Takes a **Date** object and converts it to a string representing the UTC portion of it.
 *
 * @param {Date} datetime - The **Date** object to convert.
 * 
 * @return {(string|null)} - A string representing the UTC portion of the provided **Date**, if it's defined. Else, **null**. The resulting string resembles an ISO-8601 string without the 'T' separator nor timezone information.
 */
function formatDateUTC_(datetime) {
  if (!datetime) {
    return null;
  }

  return datetime.getUTCFullYear() + "-" + padInt_((datetime.getUTCMonth() + 1), 2) + "-" + padInt_(datetime.getUTCDate(), 2) + " " + padInt_(datetime.getUTCHours(), 2) + ":" + padInt_(datetime.getUTCMinutes(), 2) + ":" + padInt_(datetime.getUTCSeconds(), 2);
}

/**
 * Creates a new **Date** object with the UTC timezone regardless of the client's configured timezone.
 *
 * @param {integer} year - The year of the **Date** to be created.
 * @param {integer} [month] - The month of the **Date** to be created. Defaults to **0**.
 * @param {integer} [day] - The month of the **Date** to be created. Defaults to **1**.
 * @param {integer} [hour] - The hour of the **Date** to be created. Defaults to **0**.
 * @param {integer} [minute] - The minute of the **Date** to be created. Defaults to **0**.
 * @param {integer} [second] - The second of the **Date** to be created. Defaults to **0**.
 * 
 * @return {Date} - A **Date** with the provided values and in UTC timezone.
 */
function newDate_(year, month = 0, day = 1, hour = 0, minute = 0, second = 0) {
  let d = new Date(year, month, day, hour, minute, second);
  let dFormatted = formatDateUTC_(d);
  return new Date(dFormatted);
}

/**
 * Pads an integer with leading 0s.
 *
 * @param {integer} i - The **integer** to be padded.
 * @param {integer} padCount - The maximum number of leading 0s to pad the integer with.
 * 
 * @return {string} - A string representing an integer padded with leading 0s.
 */
function padInt_(i, padCount) {
  return String(i).padStart(padCount, "0");
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="Classes_API%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520objects%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_.html">Classes_API

This module contains classes wrapping objects returned by the PSS Fleet Data API.</a></li><li><a href="Classes_Responses%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520responses%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_.html">Classes_Responses

This module contains classes wrapping responses returned by the PSS Fleet Data API.</a></li><li><a href="Client%250A%250AThis%2520module%2520contains%2520a%2520stateless%2520Pixel%2520Starships%2520Fleet%2520Data%2520API%2520client.module_.html">Client

This module contains a stateless Pixel Starships Fleet Data API client.</a></li><li><a href="Constants%250A%250AThis%2520module%2520contains%2520constants%2520used%2520in%2520other%2520modules.module_.html">Constants

This module contains constants used in other modules.</a></li><li><a href="Enums%250A%250AThis%2520module%2520contains%2520_Enums_.module_.html">Enums

This module contains "Enums".</a></li><li><a href="Helper_%250A%250AThis%2520module%2520contains%2520utility%2520functions.module_.html">Helper_

This module contains utility functions.</a></li><li><a href="Test_%250A%250AContains%2520helper%2520functions%2520for%2520testing.module_.html">Test_

Contains helper functions for testing.</a></li><li><a href="Test_integration_%250A%250AContains%2520integration%2520tests.module_.html">Test_integration_

Contains integration tests.</a></li><li><a href="Test_unit_%250A%250AContains%2520unit%2520tests.module_.html">Test_unit_

Contains unit tests.</a></li></ul><h3>Classes</h3><ul><li><a href="Classes_API%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520objects%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-Collection.html">Collection</a></li><li><a href="Classes_API%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520objects%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-CollectionMetadata.html">CollectionMetadata</a></li><li><a href="Classes_API%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520objects%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-PssAlliance.html">PssAlliance</a></li><li><a href="Classes_API%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520objects%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-PssAllianceHistory.html">PssAllianceHistory</a></li><li><a href="Classes_API%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520objects%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-PssUser.html">PssUser</a></li><li><a href="Classes_API%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520objects%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-PssUserHistory.html">PssUserHistory</a></li><li><a href="Classes_Responses%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520responses%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-AllianceHistoryResponse.html">AllianceHistoryResponse</a></li><li><a href="Classes_Responses%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520responses%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-ApiResponse_.html">ApiResponse_</a></li><li><a href="Classes_Responses%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520responses%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-CollectionAllianceResponse.html">CollectionAllianceResponse</a></li><li><a href="Classes_Responses%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520responses%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-CollectionAlliancesResponse.html">CollectionAlliancesResponse</a></li><li><a href="Classes_Responses%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520responses%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-CollectionMetadatasResponse.html">CollectionMetadatasResponse</a></li><li><a href="Classes_Responses%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520responses%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-CollectionResponse.html">CollectionResponse</a></li><li><a href="Classes_Responses%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520responses%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-CollectionUserResponse.html">CollectionUserResponse</a></li><li><a href="Classes_Responses%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520responses%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-CollectionUsersResponse.html">CollectionUsersResponse</a></li><li><a href="Classes_Responses%250A%250AThis%2520module%2520contains%2520classes%2520wrapping%2520responses%2520returned%2520by%2520the%2520PSS%2520Fleet%2520Data%2520API.module_-UserHistoryResponse.html">UserHistoryResponse</a></li><li><a href="Client%250A%250AThis%2520module%2520contains%2520a%2520stateless%2520Pixel%2520Starships%2520Fleet%2520Data%2520API%2520client.module_-Client.html">Client</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Nov 28 2024 23:32:27 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
